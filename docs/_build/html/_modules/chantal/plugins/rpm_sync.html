

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>chantal.plugins.rpm_sync &mdash; Chantal - Unified Repository Mirroring Tool</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Chantal
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/installation.html#installation-steps">Installation Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/installation.html#clone-the-repository">1. Clone the Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/installation.html#install-in-development-mode">2. Install in Development Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/installation.html#verify-installation">3. Verify Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/installation.html#database-setup">Database Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/installation.html#sqlite-development">SQLite (Development)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/installation.html#postgresql-production">PostgreSQL (Production)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/installation.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/quickstart.html">Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#initialize-chantal">1. Initialize Chantal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#configure-repositories">2. Configure Repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#list-configured-repositories">3. List Configured Repositories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#sync-repository">4. Sync Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#check-for-updates">5. Check for Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#create-snapshot">6. Create Snapshot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#publish-repository">7. Publish Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/cli-commands.html">CLI Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#global-options">Global Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#configuration-file-priority">Configuration File Priority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#initialize">Initialize</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-init"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">init</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#repository-management">Repository Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-repo-list"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">repo</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-repo-show"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">repo</span> <span class="pre">show</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-repo-sync"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">repo</span> <span class="pre">sync</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-repo-check-updates"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">repo</span> <span class="pre">check-updates</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-repo-history"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">repo</span> <span class="pre">history</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#snapshot-management">Snapshot Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-snapshot-list"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">snapshot</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-snapshot-create"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">snapshot</span> <span class="pre">create</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-snapshot-content"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">snapshot</span> <span class="pre">content</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-snapshot-diff"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">snapshot</span> <span class="pre">diff</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-snapshot-delete"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">snapshot</span> <span class="pre">delete</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#content-management">Content Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-content-list"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">content</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-content-search"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">content</span> <span class="pre">search</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-content-show"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">content</span> <span class="pre">show</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#publishing">Publishing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-publish-repo"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">publish</span> <span class="pre">repo</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-publish-snapshot"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">publish</span> <span class="pre">snapshot</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-publish-list"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">publish</span> <span class="pre">list</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-publish-unpublish"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">publish</span> <span class="pre">unpublish</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#storage-pool-management">Storage Pool Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-pool-stats"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">pool</span> <span class="pre">stats</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-pool-cleanup"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">pool</span> <span class="pre">cleanup</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-pool-verify"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">pool</span> <span class="pre">verify</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#statistics-database">Statistics &amp; Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-stats"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">stats</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-db-stats"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">db</span> <span class="pre">stats</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-db-verify"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">db</span> <span class="pre">verify</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/cli-commands.html#chantal-db-cleanup"><code class="docutils literal notranslate"><span class="pre">chantal</span> <span class="pre">db</span> <span class="pre">cleanup</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/cli-commands.html#output-formats">Output Formats</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/views.html">Views (Virtual Repositories)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#what-are-views">What are Views?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#use-cases">Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#combining-rhel-channels">1. Combining RHEL Channels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#mixing-rhel-epel">2. Mixing RHEL + EPEL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#custom-application-stacks">3. Custom Application Stacks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#location">Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#format">Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#example-configuration">Example Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#cli-commands">CLI Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#list-views">List Views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#show-view-details">Show View Details</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#publish-view-latest-rolling">Publish View (Latest/Rolling)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#view-snapshots">View Snapshots</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#create-view-snapshot-atomic-freeze">Create View Snapshot (Atomic Freeze)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#publish-view-snapshot">Publish View Snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#show-snapshot-content-compliance-audit">Show Snapshot Content (Compliance/Audit)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#workflows">Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#workflow-1-rolling-release-development">Workflow 1: Rolling Release (Development)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#workflow-2-frozen-baselines-production">Workflow 2: Frozen Baselines (Production)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#workflow-3-compliance-audit">Workflow 3: Compliance/Audit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#workflow-4-automated-monthly-compliance-reports">Workflow 4: Automated Monthly Compliance Reports</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#important-design-decisions">Important Design Decisions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#no-deduplication">1. NO Deduplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#repository-order-matters">2. Repository Order Matters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#view-snapshots-are-atomic">3. View Snapshots are Atomic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#hardlink-based-publishing">4. Hardlink-based Publishing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#client-configuration-examples">Client Configuration Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#example-1-development-rolling-release">Example 1: Development (Rolling Release)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#example-2-production-frozen-baseline">Example 2: Production (Frozen Baseline)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#example-3-testing-new-baseline">Example 3: Testing New Baseline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#view-shows-0-packages">View shows 0 packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#view-snapshot-creation-fails">View snapshot creation fails</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#published-view-doesnt-update">Published view doesn’t update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#repository-not-found-in-view">Repository not found in view</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#view-type-mismatch">View type mismatch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#migration-from-pulp-katello">Migration from Pulp/Katello</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#pulp-composite-content-views-chantal-views">Pulp “Composite Content Views” → Chantal “Views”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#technical-details">Technical Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#database-models">Database Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/views.html#storage-structure">Storage Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/views.html#future-enhancements">Future Enhancements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide/workflows.html">Workflows</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#patch-management-workflow">Patch Management Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#step-1-initial-setup">Step 1: Initial Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#step-2-create-monthly-baseline">Step 2: Create Monthly Baseline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#step-3-monthly-update-cycle">Step 3: Monthly Update Cycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#step-4-promote-to-production">Step 4: Promote to Production</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#development-environment-workflow">Development Environment Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#working-with-snapshots">Working with Snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#air-gapped-environment-workflow">Air-Gapped Environment Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#phase-1-online-system-internet-connected">Phase 1: Online System (Internet-Connected)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#phase-2-offline-system-air-gapped">Phase 2: Offline System (Air-Gapped)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#rhel-subscription-workflow">RHEL Subscription Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#setup-rhel-subscription">Setup RHEL Subscription</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#selective-mirroring-workflow">Selective Mirroring Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#example-only-mirror-web-server-packages">Example: Only Mirror Web Server Packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#multi-architecture-workflow">Multi-Architecture Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#sync-both-architectures">Sync Both Architectures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#scheduled-sync-workflow">Scheduled Sync Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#cron-example">Cron Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#systemd-timer-example">Systemd Timer Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../user-guide/workflows.html#disaster-recovery-workflow">Disaster Recovery Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#backup">Backup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../user-guide/workflows.html#restore">Restore</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/overview.html">Configuration Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#configuration-file-structure">Configuration File Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#configuration-file-priority">Configuration File Priority</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#development-vs-production">Development vs. Production</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#production-setup">Production Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#development-setup">Development Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#database-configuration">Database Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#sqlite-development-testing">SQLite (Development/Testing)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#postgresql-production">PostgreSQL (Production)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#storage-configuration">Storage Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#storage-paths">Storage Paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#directory-permissions">Directory Permissions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#proxy-configuration">Proxy Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#global-proxy">Global Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#per-repository-proxy-override">Per-Repository Proxy Override</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#no-proxy-for-specific-repository">No Proxy for Specific Repository</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#ssl-tls-configuration">SSL/TLS Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#global-ssl-settings">Global SSL Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/overview.html#per-repository-ssl-e-g-rhel-cdn">Per-Repository SSL (e.g., RHEL CDN)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#including-additional-configuration-files">Including Additional Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#configuration-validation">Configuration Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/overview.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/repositories.html">Repository Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#basic-repository-configuration">Basic Repository Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#repository-types">Repository Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#rpm-repositories">RPM Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#helm-repositories">Helm Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#alpine-apk-repositories">Alpine APK Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#apt-repositories-future">APT Repositories (Future)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#pypi-repositories-future">PyPI Repositories (Future)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#advanced-options">Advanced Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#version-retention-policy">Version Retention Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#repository-tags">Repository Tags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#custom-publishing-paths">Custom Publishing Paths</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#per-repository-settings">Per-Repository Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#proxy-override">Proxy Override</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#ssl-tls-override">SSL/TLS Override</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#http-headers">HTTP Headers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#repository-organization">Repository Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#single-file-configuration">Single File Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#multi-file-configuration">Multi-File Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#real-world-examples">Real-World Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#rhel-9-with-subscription">RHEL 9 with Subscription</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#rocky-linux-9">Rocky Linux 9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#epel-9-with-selective-mirroring">EPEL 9 with Selective Mirroring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#centos-stream-9">CentOS Stream 9</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#helm-charts-ingress-nginx">Helm Charts - Ingress NGINX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#helm-charts-bitnami-selective">Helm Charts - Bitnami (Selective)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#helm-charts-private-repository">Helm Charts - Private Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#alpine-linux-3-19-main-community">Alpine Linux 3.19 (Main + Community)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#alpine-linux-edge-rolling-release">Alpine Linux Edge (Rolling Release)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/repositories.html#alpine-linux-container-base-selective">Alpine Linux - Container Base (Selective)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#validation">Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/repositories.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/filters.html">Package Filters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#filter-types">Filter Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#pattern-based-filtering">Pattern-Based Filtering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#include-patterns">Include Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#exclude-patterns">Exclude Patterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#combined-example">Combined Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#metadata-filters">Metadata Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#architecture-filtering">Architecture Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#size-filtering">Size Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#build-time-filtering">Build Time Filtering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#rpm-specific-filters">RPM-Specific Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#exclude-source-rpms">Exclude Source RPMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#group-filtering">Group Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#license-filtering">License Filtering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#post-processing">Post-Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#only-latest-version">Only Latest Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#only-latest-n-versions">Only Latest N Versions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#complete-examples">Complete Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#example-1-web-server-packages-only">Example 1: Web Server Packages Only</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#example-2-minimal-base-system">Example 2: Minimal Base System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#example-3-security-updates-only">Example 3: Security Updates Only</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#example-4-development-tools">Example 4: Development Tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#filter-debugging">Filter Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#dry-run-mode">Dry-Run Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/filters.html#verbose-output">Verbose Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/filters.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/ssl-authentication.html">SSL/TLS and Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#global-ssl-configuration">Global SSL Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#per-repository-ssl-configuration">Per-Repository SSL Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#ssl-options">SSL Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#ca-bundle">CA Bundle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#client-certificate">Client Certificate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#client-key">Client Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#verify-server-certificate">Verify Server Certificate</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#rhel-subscription-setup">RHEL Subscription Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#method-1-using-subscription-manager-recommended">Method 1: Using subscription-manager (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#method-2-manual-certificate-download">Method 2: Manual Certificate Download</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#method-3-shared-entitlement-development">Method 3: Shared Entitlement (Development)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#complete-rhel-configuration-example">Complete RHEL Configuration Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#self-signed-certificates">Self-Signed Certificates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#option-1-add-to-system-trust-store-recommended">Option 1: Add to System Trust Store (Recommended)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#option-2-custom-ca-bundle">Option 2: Custom CA Bundle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#option-3-disable-verification-not-recommended">Option 3: Disable Verification (Not Recommended)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#certificate-errors">Certificate Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#client-certificate-errors">Client Certificate Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#permission-errors">Permission Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../configuration/ssl-authentication.html#check-certificate-validity">Check Certificate Validity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/ssl-authentication.html#security-best-practices">Security Best Practices</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview.html">Architecture Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#core-principles">Core Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#system-architecture">System Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#components">Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#cli-layer">CLI Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#core-layer">Core Layer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../architecture/overview.html#configuration-management">Configuration Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../architecture/overview.html#storage-manager">Storage Manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../architecture/overview.html#database-manager">Database Manager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#plugin-layer">Plugin Layer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../architecture/overview.html#sync-plugins">Sync Plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../architecture/overview.html#publisher-plugins">Publisher Plugins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#data-flow">Data Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#sync-workflow">Sync Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#publish-workflow">Publish Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#technology-stack">Technology Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#runtime">Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#development">Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#database">Database</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#design-decisions">Design Decisions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#why-content-addressed-storage">Why Content-Addressed Storage?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#why-database-for-metadata">Why Database for Metadata?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#why-hardlinks-for-publishing">Why Hardlinks for Publishing?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#performance-characteristics">Performance Characteristics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#sync-performance">Sync Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#storage-efficiency">Storage Efficiency</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#database-performance">Database Performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#extensibility-points">Extensibility Points</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#adding-repository-types">Adding Repository Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#adding-filter-types">Adding Filter Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/overview.html#adding-output-formats">Adding Output Formats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#security-considerations">Security Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/overview.html#future-enhancements">Future Enhancements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/content-addressed-storage.html">Content-Addressed Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#storage-structure">Storage Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#level-directory-hierarchy">2-Level Directory Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#why-2-levels">Why 2 Levels?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#deduplication">Deduplication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#automatic-deduplication">Automatic Deduplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#cross-repository-deduplication">Cross-Repository Deduplication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#database-integration">Database Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#package-model">Package Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#junction-table">Junction Table</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#hardlink-based-publishing">Hardlink-Based Publishing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#storage-operations">Storage Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#add-package">Add Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#create-hardlink">Create Hardlink</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#verify-pool-integrity">Verify Pool Integrity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#cleanup-orphaned-files">Cleanup Orphaned Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#storage-statistics">Storage Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#pool-stats">Pool Stats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#deduplication-stats">Deduplication Stats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#advantages">Advantages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#limitations">Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/content-addressed-storage.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema.html">Database Schema</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#core-models">Core Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#package">Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#repository">Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#snapshot">Snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#view">View</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#viewsnapshot">ViewSnapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#synchistory">SyncHistory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#junction-tables">Junction Tables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#repository-packages">repository_packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#snapshot-packages">snapshot_packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#view-repositories">view_repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#view-snapshot-snapshots">view_snapshot_snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#indexes">Indexes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#database-migrations">Database Migrations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#migration-files">Migration Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#run-migrations">Run Migrations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#example-queries">Example Queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#find-all-packages-in-repository">Find all packages in repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#find-all-repositories-containing-a-package">Find all repositories containing a package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#create-snapshot">Create snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#find-packages-added-between-snapshots">Find packages added between snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#database-backends">Database Backends</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#sqlite-development">SQLite (Development)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#postgresql-production">PostgreSQL (Production)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#database-size-estimates">Database Size Estimates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#maintenance">Maintenance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#vacuum-sqlite">Vacuum (SQLite)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#analyze-postgresql">Analyze (PostgreSQL)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/database-schema.html#cleanup-orphaned-packages">Cleanup Orphaned Packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/database-schema.html#schema-diagram">Schema Diagram</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/plugin-system.html">Plugin System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#plugin-types">Plugin Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#sync-plugin">Sync Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#publisher-plugin">Publisher Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#available-plugins">Available Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#rpm-plugin">RPM Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#deb-apt-plugin">DEB/APT Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#pypi-plugin">PyPI Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#plugin-registration">Plugin Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#creating-a-custom-plugin">Creating a Custom Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#implement-sync-plugin">1. Implement Sync Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#implement-publisher-plugin">2. Implement Publisher Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#register-plugin">3. Register Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#add-configuration-support">4. Add Configuration Support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#plugin-lifecycle">Plugin Lifecycle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#sync-lifecycle">Sync Lifecycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#publish-lifecycle">Publish Lifecycle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#plugin-helpers">Plugin Helpers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#storagemanager">StorageManager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#http-client">HTTP Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#filter-engine">Filter Engine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#testing-plugins">Testing Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#unit-tests">Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/plugin-system.html#integration-tests">Integration Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../architecture/plugin-system.html#future-enhancements">Future Enhancements</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins/overview.html">Plugins Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#what-are-plugins">What are Plugins?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#available-plugins">Available Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#plugin-architecture">Plugin Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#how-plugins-work">How Plugins Work</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/overview.html#sync-plugin-workflow">Sync Plugin Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/overview.html#publisher-plugin-workflow">Publisher Plugin Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#plugin-types">Plugin Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/overview.html#rpm-plugin">RPM Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/overview.html#deb-apt-plugin-planned">DEB/APT Plugin (Planned)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/overview.html#pypi-plugin-planned">PyPI Plugin (Planned)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#creating-custom-plugins">Creating Custom Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#plugin-configuration">Plugin Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#plugin-registry">Plugin Registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#plugin-best-practices">Plugin Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/overview.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins/rpm-plugin.html">RPM Plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#basic-rpm-repository">Basic RPM Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#with-filters">With Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#rhel-with-client-certificates">RHEL with Client Certificates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#how-it-works">How It Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#sync-process">Sync Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#publish-process">Publish Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#metadata-files">Metadata Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#repomd-xml">repomd.xml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#primary-xml-gz">primary.xml.gz</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#rpm-specific-filters">RPM-Specific Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#exclude-source-rpms">Exclude Source RPMs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#group-filtering">Group Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#license-filtering">License Filtering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#supported-distributions">Supported Distributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#red-hat-enterprise-linux-rhel">Red Hat Enterprise Linux (RHEL)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#centos-stream">CentOS Stream</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#fedora">Fedora</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#epel-extra-packages-for-enterprise-linux">EPEL (Extra Packages for Enterprise Linux)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#rocky-linux">Rocky Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#almalinux">AlmaLinux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#metadata-not-found">Metadata Not Found</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#checksum-mismatch">Checksum Mismatch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/rpm-plugin.html#no-packages-after-filtering">No Packages After Filtering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/rpm-plugin.html#future-enhancements">Future Enhancements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins/helm-plugin.html">Helm Plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#basic-helm-repository">Basic Helm Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#with-filters">With Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#with-authentication">With Authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#how-it-works">How It Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#sync-process">Sync Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#publish-process">Publish Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#chart-filtering">Chart Filtering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#pattern-filters">Pattern Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#version-filtering">Version Filtering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#common-use-cases">Common Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#mirror-official-kubernetes-charts">Mirror Official Kubernetes Charts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#mirror-bitnami-charts-selective">Mirror Bitnami Charts (Selective)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#mirror-harbor-registry">Mirror Harbor Registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#private-chart-repository">Private Chart Repository</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#publishing-helm-repositories">Publishing Helm Repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#publish-latest-repository">Publish Latest Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#publish-snapshot">Publish Snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#configure-helm-client">Configure Helm Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#configure-helm-with-snapshot">Configure Helm with Snapshot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#chart-metadata">Chart Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#charts-not-syncing">Charts Not Syncing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#publishing-issues">Publishing Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#client-certificate-issues">Client Certificate Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#integration-with-ci-cd">Integration with CI/CD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#gitops-workflow">GitOps Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/helm-plugin.html#jenkins-pipeline">Jenkins Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/helm-plugin.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins/apk-plugin.html">Alpine APK Plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#basic-alpine-repository">Basic Alpine Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#with-filters">With Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#multiple-architectures">Multiple Architectures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#how-it-works">How It Works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#sync-process">Sync Process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#publish-process">Publish Process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#package-filtering">Package Filtering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#pattern-filters">Pattern Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#version-filtering">Version Filtering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#common-use-cases">Common Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#mirror-complete-alpine-branch">Mirror Complete Alpine Branch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#mirror-community-repository">Mirror Community Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#mirror-edge-rolling-release">Mirror Edge (Rolling Release)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#selective-mirroring-container-base">Selective Mirroring (Container Base)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#publishing-alpine-repositories">Publishing Alpine Repositories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#publish-latest-repository">Publish Latest Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#publish-snapshot">Publish Snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#configure-alpine-linux-client">Configure Alpine Linux Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#configure-alpine-with-snapshot">Configure Alpine with Snapshot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#package-metadata">Package Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#alpine-specific-features">Alpine-Specific Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#version-format">Version Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#repository-types">Repository Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#alpine-branches">Alpine Branches</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#apkindex-not-found">APKINDEX Not Found</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#sha1-checksum-warnings">SHA1 Checksum Warnings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#no-packages-after-filtering">No Packages After Filtering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#architecture-mismatch">Architecture Mismatch</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#integration-with-docker">Integration with Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#alpine-base-image-builds">Alpine Base Image Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/apk-plugin.html#multi-architecture-builds">Multi-Architecture Builds</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/apk-plugin.html#further-reading">Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../plugins/custom-plugins.html">Creating Custom Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#step-1-create-plugin-files">Step 1: Create Plugin Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#step-2-implement-sync-plugin">Step 2: Implement Sync Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/custom-plugins.html#basic-structure">Basic Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/custom-plugins.html#helper-methods">Helper Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../plugins/custom-plugins.html#http-client">HTTP Client</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../plugins/custom-plugins.html#download-file">Download File</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#step-3-implement-publisher-plugin">Step 3: Implement Publisher Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/custom-plugins.html#id1">Basic Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../plugins/custom-plugins.html#metadata-generation-example">Metadata Generation Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#step-4-register-plugin">Step 4: Register Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#step-5-add-configuration-support">Step 5: Add Configuration Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#step-6-write-tests">Step 6: Write Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#example-simple-http-archive-plugin">Example: Simple HTTP Archive Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#best-practices">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#testing-your-plugin">Testing Your Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/custom-plugins.html#contributing-your-plugin">Contributing Your Plugin</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/modules.html#core-modules">Core Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#module-chantal.core.config">Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.ApkConfig"><code class="docutils literal notranslate"><span class="pre">ApkConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.AuthConfig"><code class="docutils literal notranslate"><span class="pre">AuthConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.ConfigLoader"><code class="docutils literal notranslate"><span class="pre">ConfigLoader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.DatabaseConfig"><code class="docutils literal notranslate"><span class="pre">DatabaseConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.DebFilterConfig"><code class="docutils literal notranslate"><span class="pre">DebFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.FilterConfig"><code class="docutils literal notranslate"><span class="pre">FilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.GenericMetadataFilterConfig"><code class="docutils literal notranslate"><span class="pre">GenericMetadataFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.GlobalConfig"><code class="docutils literal notranslate"><span class="pre">GlobalConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.ListFilterConfig"><code class="docutils literal notranslate"><span class="pre">ListFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.PatternFilterConfig"><code class="docutils literal notranslate"><span class="pre">PatternFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.PostProcessingConfig"><code class="docutils literal notranslate"><span class="pre">PostProcessingConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.ProxyConfig"><code class="docutils literal notranslate"><span class="pre">ProxyConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.RepositoryConfig"><code class="docutils literal notranslate"><span class="pre">RepositoryConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.RetentionConfig"><code class="docutils literal notranslate"><span class="pre">RetentionConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.RpmFilterConfig"><code class="docutils literal notranslate"><span class="pre">RpmFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.SSLConfig"><code class="docutils literal notranslate"><span class="pre">SSLConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.ScheduleConfig"><code class="docutils literal notranslate"><span class="pre">ScheduleConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.SizeFilterConfig"><code class="docutils literal notranslate"><span class="pre">SizeFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.StorageConfig"><code class="docutils literal notranslate"><span class="pre">StorageConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.TimeFilterConfig"><code class="docutils literal notranslate"><span class="pre">TimeFilterConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.ViewConfig"><code class="docutils literal notranslate"><span class="pre">ViewConfig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.create_example_config"><code class="docutils literal notranslate"><span class="pre">create_example_config()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.config.load_config"><code class="docutils literal notranslate"><span class="pre">load_config()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#module-chantal.core.storage">Storage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.core.storage.StorageManager"><code class="docutils literal notranslate"><span class="pre">StorageManager</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/modules.html#module-chantal.db.models">Database Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Base"><code class="docutils literal notranslate"><span class="pre">Base</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Base.metadata"><code class="docutils literal notranslate"><span class="pre">Base.metadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Base.registry"><code class="docutils literal notranslate"><span class="pre">Base.registry</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem"><code class="docutils literal notranslate"><span class="pre">ContentItem</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.content_metadata"><code class="docutils literal notranslate"><span class="pre">ContentItem.content_metadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.content_type"><code class="docutils literal notranslate"><span class="pre">ContentItem.content_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.created_at"><code class="docutils literal notranslate"><span class="pre">ContentItem.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.filename"><code class="docutils literal notranslate"><span class="pre">ContentItem.filename</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.id"><code class="docutils literal notranslate"><span class="pre">ContentItem.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.name"><code class="docutils literal notranslate"><span class="pre">ContentItem.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.nevra"><code class="docutils literal notranslate"><span class="pre">ContentItem.nevra</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.pool_path"><code class="docutils literal notranslate"><span class="pre">ContentItem.pool_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.reference_count"><code class="docutils literal notranslate"><span class="pre">ContentItem.reference_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.repositories"><code class="docutils literal notranslate"><span class="pre">ContentItem.repositories</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.sha256"><code class="docutils literal notranslate"><span class="pre">ContentItem.sha256</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.size_bytes"><code class="docutils literal notranslate"><span class="pre">ContentItem.size_bytes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.snapshots"><code class="docutils literal notranslate"><span class="pre">ContentItem.snapshots</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ContentItem.version"><code class="docutils literal notranslate"><span class="pre">ContentItem.version</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository"><code class="docutils literal notranslate"><span class="pre">Repository</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.content_items"><code class="docutils literal notranslate"><span class="pre">Repository.content_items</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.created_at"><code class="docutils literal notranslate"><span class="pre">Repository.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.enabled"><code class="docutils literal notranslate"><span class="pre">Repository.enabled</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.feed"><code class="docutils literal notranslate"><span class="pre">Repository.feed</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.id"><code class="docutils literal notranslate"><span class="pre">Repository.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.last_sync_at"><code class="docutils literal notranslate"><span class="pre">Repository.last_sync_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.last_sync_status"><code class="docutils literal notranslate"><span class="pre">Repository.last_sync_status</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.latest_path"><code class="docutils literal notranslate"><span class="pre">Repository.latest_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.name"><code class="docutils literal notranslate"><span class="pre">Repository.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.repo_id"><code class="docutils literal notranslate"><span class="pre">Repository.repo_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.snapshots"><code class="docutils literal notranslate"><span class="pre">Repository.snapshots</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.snapshots_path"><code class="docutils literal notranslate"><span class="pre">Repository.snapshots_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.sync_history"><code class="docutils literal notranslate"><span class="pre">Repository.sync_history</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.type"><code class="docutils literal notranslate"><span class="pre">Repository.type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Repository.updated_at"><code class="docutils literal notranslate"><span class="pre">Repository.updated_at</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot"><code class="docutils literal notranslate"><span class="pre">Snapshot</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.content_items"><code class="docutils literal notranslate"><span class="pre">Snapshot.content_items</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.created_at"><code class="docutils literal notranslate"><span class="pre">Snapshot.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.description"><code class="docutils literal notranslate"><span class="pre">Snapshot.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.id"><code class="docutils literal notranslate"><span class="pre">Snapshot.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.is_published"><code class="docutils literal notranslate"><span class="pre">Snapshot.is_published</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.name"><code class="docutils literal notranslate"><span class="pre">Snapshot.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.package_count"><code class="docutils literal notranslate"><span class="pre">Snapshot.package_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.published_path"><code class="docutils literal notranslate"><span class="pre">Snapshot.published_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.repository"><code class="docutils literal notranslate"><span class="pre">Snapshot.repository</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.repository_id"><code class="docutils literal notranslate"><span class="pre">Snapshot.repository_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.Snapshot.total_size_bytes"><code class="docutils literal notranslate"><span class="pre">Snapshot.total_size_bytes</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory"><code class="docutils literal notranslate"><span class="pre">SyncHistory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.bytes_downloaded"><code class="docutils literal notranslate"><span class="pre">SyncHistory.bytes_downloaded</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.completed_at"><code class="docutils literal notranslate"><span class="pre">SyncHistory.completed_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.duration_seconds"><code class="docutils literal notranslate"><span class="pre">SyncHistory.duration_seconds</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.error_message"><code class="docutils literal notranslate"><span class="pre">SyncHistory.error_message</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.id"><code class="docutils literal notranslate"><span class="pre">SyncHistory.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.packages_added"><code class="docutils literal notranslate"><span class="pre">SyncHistory.packages_added</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.packages_removed"><code class="docutils literal notranslate"><span class="pre">SyncHistory.packages_removed</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.packages_updated"><code class="docutils literal notranslate"><span class="pre">SyncHistory.packages_updated</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.repository"><code class="docutils literal notranslate"><span class="pre">SyncHistory.repository</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.repository_id"><code class="docutils literal notranslate"><span class="pre">SyncHistory.repository_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.snapshot"><code class="docutils literal notranslate"><span class="pre">SyncHistory.snapshot</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.snapshot_id"><code class="docutils literal notranslate"><span class="pre">SyncHistory.snapshot_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.started_at"><code class="docutils literal notranslate"><span class="pre">SyncHistory.started_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.SyncHistory.status"><code class="docutils literal notranslate"><span class="pre">SyncHistory.status</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View"><code class="docutils literal notranslate"><span class="pre">View</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.created_at"><code class="docutils literal notranslate"><span class="pre">View.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.description"><code class="docutils literal notranslate"><span class="pre">View.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.id"><code class="docutils literal notranslate"><span class="pre">View.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.is_published"><code class="docutils literal notranslate"><span class="pre">View.is_published</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.name"><code class="docutils literal notranslate"><span class="pre">View.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.published_at"><code class="docutils literal notranslate"><span class="pre">View.published_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.published_path"><code class="docutils literal notranslate"><span class="pre">View.published_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.repo_type"><code class="docutils literal notranslate"><span class="pre">View.repo_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.updated_at"><code class="docutils literal notranslate"><span class="pre">View.updated_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.view_repositories"><code class="docutils literal notranslate"><span class="pre">View.view_repositories</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.View.view_snapshots"><code class="docutils literal notranslate"><span class="pre">View.view_snapshots</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository"><code class="docutils literal notranslate"><span class="pre">ViewRepository</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.added_at"><code class="docutils literal notranslate"><span class="pre">ViewRepository.added_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.id"><code class="docutils literal notranslate"><span class="pre">ViewRepository.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.order"><code class="docutils literal notranslate"><span class="pre">ViewRepository.order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.repository"><code class="docutils literal notranslate"><span class="pre">ViewRepository.repository</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.repository_id"><code class="docutils literal notranslate"><span class="pre">ViewRepository.repository_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.view"><code class="docutils literal notranslate"><span class="pre">ViewRepository.view</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewRepository.view_id"><code class="docutils literal notranslate"><span class="pre">ViewRepository.view_id</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.created_at"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.created_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.description"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.description</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.id"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.is_published"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.is_published</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.name"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.package_count"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.package_count</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.published_at"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.published_at</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.published_path"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.published_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.snapshot_ids"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.snapshot_ids</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.total_size_bytes"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.total_size_bytes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.view"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.view</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.db.models.ViewSnapshot.view_id"><code class="docutils literal notranslate"><span class="pre">ViewSnapshot.view_id</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/modules.html#plugins">Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#module-chantal.plugins.base">Base Plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.base.PublisherPlugin"><code class="docutils literal notranslate"><span class="pre">PublisherPlugin</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/modules.html#module-chantal.plugins.rpm">RPM Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.rpm.RpmPublisher"><code class="docutils literal notranslate"><span class="pre">RpmPublisher</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.rpm_sync.CheckUpdatesResult"><code class="docutils literal notranslate"><span class="pre">CheckUpdatesResult</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.rpm_sync.PackageMetadata"><code class="docutils literal notranslate"><span class="pre">PackageMetadata</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.rpm_sync.PackageUpdate"><code class="docutils literal notranslate"><span class="pre">PackageUpdate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.rpm_sync.RpmSyncPlugin"><code class="docutils literal notranslate"><span class="pre">RpmSyncPlugin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/modules.html#chantal.plugins.rpm_sync.SyncResult"><code class="docutils literal notranslate"><span class="pre">SyncResult</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/modules.html#module-chantal.cli">CLI</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Chantal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">chantal.plugins.rpm_sync</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for chantal.plugins.rpm_sync</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RPM repository sync plugin.</span>

<span class="sd">This module implements syncing RPM repositories from upstream sources.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lzma</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urljoin</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">chantal.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">FilterConfig</span><span class="p">,</span>
    <span class="n">GenericMetadataFilterConfig</span><span class="p">,</span>
    <span class="n">ListFilterConfig</span><span class="p">,</span>
    <span class="n">PatternFilterConfig</span><span class="p">,</span>
    <span class="n">ProxyConfig</span><span class="p">,</span>
    <span class="n">RepositoryConfig</span><span class="p">,</span>
    <span class="n">RpmFilterConfig</span><span class="p">,</span>
    <span class="n">SizeFilterConfig</span><span class="p">,</span>
    <span class="n">TimeFilterConfig</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chantal.core.storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">StorageManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chantal.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ContentItem</span><span class="p">,</span> <span class="n">Repository</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chantal.plugins.rpm.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">RpmMetadata</span>


<div class="viewcode-block" id="PackageMetadata">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.PackageMetadata">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PackageMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Package metadata from primary.xml.&quot;&quot;&quot;</span>

    <span class="c1"># Basic package info</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">release</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">epoch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">arch</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sha256</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">size_bytes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Relative URL to package file</span>

    <span class="c1"># Optional metadata</span>
    <span class="n">summary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Extended metadata for filtering</span>
    <span class="n">build_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># Unix timestamp (when built)</span>
    <span class="n">file_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>       <span class="c1"># Unix timestamp (file modification)</span>
    <span class="n">group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>           <span class="c1"># RPM group (e.g., &quot;Applications/Internet&quot;)</span>
    <span class="n">license</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>         <span class="c1"># License string</span>
    <span class="n">vendor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>          <span class="c1"># Vendor/Packager</span>
    <span class="n">sourcerpm</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>       <span class="c1"># Source RPM filename (to identify .src.rpm)</span></div>



<div class="viewcode-block" id="SyncResult">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.SyncResult">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SyncResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a repository sync operation.&quot;&quot;&quot;</span>

    <span class="n">packages_downloaded</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">packages_skipped</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Already in pool</span>
    <span class="n">packages_total</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">bytes_downloaded</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="PackageUpdate">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.PackageUpdate">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PackageUpdate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Information about an available package update.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">arch</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">local_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># None if package is new</span>
    <span class="n">local_release</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">remote_version</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">remote_release</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">remote_epoch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">size_bytes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">sha256</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_new</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this is a new package (not currently installed).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_version</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nvra</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get name-version-release.arch string.&quot;&quot;&quot;</span>
        <span class="n">epoch_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_epoch</span><span class="si">}</span><span class="s2">:&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote_epoch</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">epoch_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_version</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_release</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span></div>



<div class="viewcode-block" id="CheckUpdatesResult">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.CheckUpdatesResult">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CheckUpdatesResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result of a check-updates operation.&quot;&quot;&quot;</span>

    <span class="n">updates_available</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageUpdate</span><span class="p">]</span>
    <span class="n">total_packages</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Total packages in upstream</span>
    <span class="n">total_size_bytes</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Total size of updates</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="RpmSyncPlugin">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.RpmSyncPlugin">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RpmSyncPlugin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plugin for syncing RPM repositories.</span>

<span class="sd">    Handles:</span>
<span class="sd">    - Fetching upstream repomd.xml</span>
<span class="sd">    - Parsing primary.xml.gz for package list</span>
<span class="sd">    - Downloading packages to storage pool</span>
<span class="sd">    - Updating database</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">storage</span><span class="p">:</span> <span class="n">StorageManager</span><span class="p">,</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">RepositoryConfig</span><span class="p">,</span>
        <span class="n">proxy_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ProxyConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ssl_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;SSLConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize RPM sync plugin.</span>

<span class="sd">        Args:</span>
<span class="sd">            storage: Storage manager instance</span>
<span class="sd">            config: Repository configuration</span>
<span class="sd">            proxy_config: Optional proxy configuration</span>
<span class="sd">            ssl_config: Optional SSL/TLS configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy_config</span> <span class="o">=</span> <span class="n">proxy_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssl_config</span> <span class="o">=</span> <span class="n">ssl_config</span>

        <span class="c1"># Setup HTTP session with proxy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">proxy_config</span><span class="p">:</span>
            <span class="n">proxies</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">http_proxy</span><span class="p">:</span>
                <span class="n">proxies</span><span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">http_proxy</span>
            <span class="k">if</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">https_proxy</span><span class="p">:</span>
                <span class="n">proxies</span><span class="p">[</span><span class="s2">&quot;https&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">https_proxy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">proxies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>

            <span class="c1"># Basic auth for proxy if needed</span>
            <span class="k">if</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">username</span> <span class="ow">and</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">proxy_config</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">proxy_config</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

        <span class="c1"># Setup SSL/TLS verification</span>
        <span class="k">if</span> <span class="n">ssl_config</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">verify</span><span class="p">:</span>
                <span class="c1"># Disable SSL verification (not recommended)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">ca_cert</span><span class="p">:</span>
                <span class="c1"># Use inline CA certificate - write to temp file</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
                <span class="n">ca_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.pem&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">ca_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ssl_config</span><span class="o">.</span><span class="n">ca_cert</span><span class="p">)</span>
                <span class="n">ca_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">ca_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">ca_file</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_temp_ca_file</span> <span class="o">=</span> <span class="n">ca_file</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># Store for cleanup</span>
            <span class="k">elif</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">ca_bundle</span><span class="p">:</span>
                <span class="c1"># Use CA bundle file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">ca_bundle</span>

            <span class="c1"># Setup client certificate for mTLS if configured</span>
            <span class="k">if</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">client_cert</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">client_key</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="p">(</span><span class="n">ssl_config</span><span class="o">.</span><span class="n">client_cert</span><span class="p">,</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">client_key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="n">ssl_config</span><span class="o">.</span><span class="n">client_cert</span>

        <span class="c1"># Setup repository authentication</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;client_cert&quot;</span><span class="p">:</span>
                <span class="c1"># Client certificate authentication (RHEL CDN)</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">cert_file</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">key_file</span><span class="p">:</span>
                    <span class="c1"># Specific cert/key files provided</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">cert_file</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">key_file</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using client certificate authentication&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">cert_dir</span><span class="p">:</span>
                    <span class="c1"># Find cert/key in directory (RHEL entitlement pattern)</span>
                    <span class="n">cert_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">cert_dir</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cert_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                        <span class="c1"># Find first .pem certificate (not -key.pem)</span>
                        <span class="n">certs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cert_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.pem&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;-key.pem&quot;</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="n">certs</span><span class="p">:</span>
                            <span class="n">cert_file</span> <span class="o">=</span> <span class="n">certs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="c1"># Look for corresponding key file</span>
                            <span class="n">key_file</span> <span class="o">=</span> <span class="n">cert_dir</span> <span class="o">/</span> <span class="n">cert_file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;-key.pem&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">key_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cert_file</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_file</span><span class="p">))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using client certificate: </span><span class="si">{</span><span class="n">cert_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Key file not found for </span><span class="si">{</span><span class="n">cert_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;basic&quot;</span><span class="p">:</span>
                <span class="c1"># HTTP Basic authentication</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">username</span> <span class="ow">and</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using HTTP Basic authentication (user: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;bearer&quot;</span><span class="p">:</span>
                <span class="c1"># Bearer token authentication</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">})</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Bearer token authentication&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
                <span class="c1"># Custom HTTP headers</span>
                <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using custom headers: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># SSL/TLS verification settings</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">verify_ssl</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: SSL certificate verification disabled&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">ca_bundle</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">ca_bundle</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using custom CA bundle: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">ca_bundle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="RpmSyncPlugin.sync_repository">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.RpmSyncPlugin.sync_repository">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sync_repository</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="n">Repository</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SyncResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sync repository from upstream.</span>

<span class="sd">        Args:</span>
<span class="sd">            session: Database session</span>
<span class="sd">            repository: Repository model instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            SyncResult with sync statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Syncing repository: </span><span class="si">{</span><span class="n">repository</span><span class="o">.</span><span class="n">repo_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feed URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Step 1: Fetch repomd.xml</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fetching repomd.xml...&quot;</span><span class="p">)</span>
            <span class="n">repomd_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_repomd_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span><span class="p">)</span>

            <span class="c1"># Step 2: Extract primary.xml.gz location</span>
            <span class="n">primary_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_primary_location</span><span class="p">(</span><span class="n">repomd_root</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Primary metadata location: </span><span class="si">{</span><span class="n">primary_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Step 3: Download and parse primary.xml.gz</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fetching primary.xml.gz...&quot;</span><span class="p">)</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_primary_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span><span class="p">,</span> <span class="n">primary_location</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> packages in repository&quot;</span><span class="p">)</span>

            <span class="c1"># Step 4: Apply filters if configured</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
                <span class="n">original_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
                <span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_filters</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
                <span class="n">filtered_out</span> <span class="o">=</span> <span class="n">original_count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">filtered_out</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtered out </span><span class="si">{</span><span class="n">filtered_out</span><span class="si">}</span><span class="s2"> packages, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> remaining&quot;</span><span class="p">)</span>

            <span class="c1"># Step 5: Get existing packages from database</span>
            <span class="n">existing_packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_existing_packages</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">existing_packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> packages in pool&quot;</span><span class="p">)</span>

            <span class="c1"># Step 6: Download new packages</span>
            <span class="n">packages_downloaded</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">packages_skipped</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bytes_downloaded</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pkg_meta</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="si">}</span><span class="s2">] Processing </span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">release</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Check if package already exists by SHA256</span>
                <span class="k">if</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span> <span class="ow">in</span> <span class="n">existing_packages</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  → Already in pool (SHA256: </span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="si">}</span><span class="s2">...)&quot;</span><span class="p">)</span>
                    <span class="n">packages_skipped</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c1"># Link existing package to this repository if not already linked</span>
                    <span class="n">existing_pkg</span> <span class="o">=</span> <span class="n">existing_packages</span><span class="p">[</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">repository</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_pkg</span><span class="o">.</span><span class="n">repositories</span><span class="p">:</span>
                        <span class="n">existing_pkg</span><span class="o">.</span><span class="n">repositories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
                        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  → Linked to repository&quot;</span><span class="p">)</span>

                    <span class="k">continue</span>

                <span class="c1"># Download package</span>
                <span class="n">pkg_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  → Downloading from </span><span class="si">{</span><span class="n">pkg_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">downloaded_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_package</span><span class="p">(</span>
                        <span class="n">pkg_url</span><span class="p">,</span> <span class="n">pkg_meta</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">repository</span>
                    <span class="p">)</span>
                    <span class="n">packages_downloaded</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">bytes_downloaded</span> <span class="o">+=</span> <span class="n">downloaded_bytes</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  → Downloaded </span><span class="si">{</span><span class="n">downloaded_bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  → ERROR: Failed to download: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Continue with next package</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sync complete!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Downloaded: </span><span class="si">{</span><span class="n">packages_downloaded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Skipped: </span><span class="si">{</span><span class="n">packages_skipped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total size: </span><span class="si">{</span><span class="n">bytes_downloaded</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">SyncResult</span><span class="p">(</span>
                <span class="n">packages_downloaded</span><span class="o">=</span><span class="n">packages_downloaded</span><span class="p">,</span>
                <span class="n">packages_skipped</span><span class="o">=</span><span class="n">packages_skipped</span><span class="p">,</span>
                <span class="n">packages_total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">),</span>
                <span class="n">bytes_downloaded</span><span class="o">=</span><span class="n">bytes_downloaded</span><span class="p">,</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sync failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SyncResult</span><span class="p">(</span>
                <span class="n">packages_downloaded</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">packages_skipped</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">packages_total</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">bytes_downloaded</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="RpmSyncPlugin.check_updates">
<a class="viewcode-back" href="../../../api/modules.html#chantal.plugins.rpm_sync.RpmSyncPlugin.check_updates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_updates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="n">Repository</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CheckUpdatesResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for available package updates without downloading.</span>

<span class="sd">        Args:</span>
<span class="sd">            session: Database session</span>
<span class="sd">            repository: Repository model instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            CheckUpdatesResult with list of available updates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking for updates: </span><span class="si">{</span><span class="n">repository</span><span class="o">.</span><span class="n">repo_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feed URL: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Step 1: Fetch repomd.xml</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fetching repomd.xml...&quot;</span><span class="p">)</span>
            <span class="n">repomd_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_repomd_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span><span class="p">)</span>

            <span class="c1"># Step 2: Extract primary.xml location</span>
            <span class="n">primary_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_primary_location</span><span class="p">(</span><span class="n">repomd_root</span><span class="p">)</span>

            <span class="c1"># Step 3: Download and parse primary.xml</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fetching primary.xml...&quot;</span><span class="p">)</span>
            <span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_primary_xml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">feed</span><span class="p">,</span> <span class="n">primary_location</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> packages in upstream repository&quot;</span><span class="p">)</span>

            <span class="c1"># Step 4: Apply filters if configured</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
                <span class="n">original_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
                <span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_filters</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
                <span class="n">filtered_out</span> <span class="o">=</span> <span class="n">original_count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">filtered_out</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filtered out </span><span class="si">{</span><span class="n">filtered_out</span><span class="si">}</span><span class="s2"> packages, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> remaining&quot;</span><span class="p">)</span>

            <span class="c1"># Step 5: Get existing packages from database for this repository</span>
            <span class="n">existing_packages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">repository</span><span class="o">.</span><span class="n">content_items</span><span class="p">:</span>
                <span class="c1"># Build a key based on name and arch</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">existing_packages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pkg</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Currently have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">existing_packages</span><span class="p">)</span><span class="si">}</span><span class="s2"> unique packages (by name-arch)&quot;</span><span class="p">)</span>

            <span class="c1"># Step 6: Compare and find updates/new packages</span>
            <span class="n">updates</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">total_update_size</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">pkg_meta</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">existing_pkg</span> <span class="o">=</span> <span class="n">existing_packages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">existing_pkg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># New package not in our repository</span>
                    <span class="n">update</span> <span class="o">=</span> <span class="n">PackageUpdate</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">arch</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span>
                        <span class="n">local_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">local_release</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">remote_version</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                        <span class="n">remote_release</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
                        <span class="n">remote_epoch</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span>
                        <span class="n">size_bytes</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">size_bytes</span><span class="p">,</span>
                        <span class="n">sha256</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span><span class="p">,</span>
                        <span class="n">location</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">updates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
                    <span class="n">total_update_size</span> <span class="o">+=</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">size_bytes</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Package exists - check if remote version is newer</span>
                    <span class="n">remote_epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">epoch</span> <span class="ow">or</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
                    <span class="n">local_epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">existing_pkg</span><span class="o">.</span><span class="n">content_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

                    <span class="c1"># EPO CH-style version comparison: compare epoch, then version, then release</span>
                    <span class="n">is_newer</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="n">remote_epoch</span> <span class="o">&gt;</span> <span class="n">local_epoch</span><span class="p">:</span>
                        <span class="n">is_newer</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">remote_epoch</span> <span class="o">==</span> <span class="n">local_epoch</span><span class="p">:</span>
                        <span class="c1"># Compare version (use packaging library for proper version comparison)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">remote_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
                            <span class="n">local_ver</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">existing_pkg</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">remote_ver</span> <span class="o">&gt;</span> <span class="n">local_ver</span><span class="p">:</span>
                                <span class="n">is_newer</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">remote_ver</span> <span class="o">==</span> <span class="n">local_ver</span><span class="p">:</span>
                                <span class="c1"># Compare release</span>
                                <span class="n">remote_rel</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">release</span><span class="p">)</span>
                                <span class="n">local_rel</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">existing_pkg</span><span class="o">.</span><span class="n">content_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

                                <span class="k">if</span> <span class="n">remote_rel</span> <span class="o">&gt;</span> <span class="n">local_rel</span><span class="p">:</span>
                                    <span class="n">is_newer</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="c1"># Fallback to string comparison if packaging fails</span>
                            <span class="k">if</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span> <span class="o">&gt;</span> <span class="n">existing_pkg</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                                <span class="n">is_newer</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="n">existing_pkg</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">release</span> <span class="o">&gt;</span> <span class="n">existing_pkg</span><span class="o">.</span><span class="n">content_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;release&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                                    <span class="n">is_newer</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="k">if</span> <span class="n">is_newer</span><span class="p">:</span>
                        <span class="c1"># Update available</span>
                        <span class="n">update</span> <span class="o">=</span> <span class="n">PackageUpdate</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">arch</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span>
                            <span class="n">local_version</span><span class="o">=</span><span class="n">existing_pkg</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                            <span class="n">local_release</span><span class="o">=</span><span class="n">existing_pkg</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
                            <span class="n">remote_version</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                            <span class="n">remote_release</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
                            <span class="n">remote_epoch</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span>
                            <span class="n">size_bytes</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">size_bytes</span><span class="p">,</span>
                            <span class="n">sha256</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span><span class="p">,</span>
                            <span class="n">location</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">updates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
                        <span class="n">total_update_size</span> <span class="o">+=</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">size_bytes</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Check complete!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Updates available: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total size: </span><span class="si">{</span><span class="n">total_update_size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">CheckUpdatesResult</span><span class="p">(</span>
                <span class="n">updates_available</span><span class="o">=</span><span class="n">updates</span><span class="p">,</span>
                <span class="n">total_packages</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">packages</span><span class="p">),</span>
                <span class="n">total_size_bytes</span><span class="o">=</span><span class="n">total_update_size</span><span class="p">,</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Check failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">CheckUpdatesResult</span><span class="p">(</span>
                <span class="n">updates_available</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">total_packages</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">total_size_bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
            <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_repomd_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch and parse repomd.xml.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_url: Base URL of repository</span>

<span class="sd">        Returns:</span>
<span class="sd">            XML root element</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.RequestException: On HTTP errors</span>
<span class="sd">            ET.ParseError: On XML parse errors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">repomd_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;repodata/repomd.xml&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">repomd_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_primary_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repomd_root</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract primary.xml.gz location from repomd.xml.</span>

<span class="sd">        Args:</span>
<span class="sd">            repomd_root: Parsed repomd.xml root element</span>

<span class="sd">        Returns:</span>
<span class="sd">            Relative path to primary.xml.gz</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If primary location not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Handle XML namespaces</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;repo&quot;</span><span class="p">:</span> <span class="s2">&quot;http://linux.duke.edu/metadata/repo&quot;</span><span class="p">}</span>

        <span class="c1"># Find data element with type=&quot;primary&quot;</span>
        <span class="n">data_elem</span> <span class="o">=</span> <span class="n">repomd_root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;repo:data[@type=&#39;primary&#39;]&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Try without namespace</span>
            <span class="n">data_elem</span> <span class="o">=</span> <span class="n">repomd_root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;data[@type=&#39;primary&#39;]&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data_elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Primary metadata location not found in repomd.xml&quot;</span><span class="p">)</span>

        <span class="n">location_elem</span> <span class="o">=</span> <span class="n">data_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;repo:location&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">location_elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">location_elem</span> <span class="o">=</span> <span class="n">data_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">location_elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Primary location element not found&quot;</span><span class="p">)</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">location_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">location</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Primary location href attribute missing&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">location</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_primary_xml</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">primary_location</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download and parse primary.xml.gz or primary.xml.xz.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_url: Base URL of repository</span>
<span class="sd">            primary_location: Relative path to primary.xml.gz or primary.xml.xz</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of package metadata</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.RequestException: On HTTP errors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">primary_url</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">primary_location</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">primary_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Decompress based on file extension</span>
        <span class="k">if</span> <span class="n">primary_location</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xz&#39;</span><span class="p">):</span>
            <span class="n">xml_content</span> <span class="o">=</span> <span class="n">lzma</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">primary_location</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.gz&#39;</span><span class="p">):</span>
            <span class="n">xml_content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to auto-detect based on magic bytes</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x1f\x8b</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># gzip magic</span>
                <span class="n">xml_content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xfd</span><span class="s1">7zXZ</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># xz magic</span>
                <span class="n">xml_content</span> <span class="o">=</span> <span class="n">lzma</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown compression format for </span><span class="si">{</span><span class="n">primary_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Parse XML</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_content</span><span class="p">)</span>

        <span class="c1"># Extract package metadata</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_primary_xml</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_primary_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse primary.xml root element.</span>

<span class="sd">        Args:</span>
<span class="sd">            root: Parsed primary.xml root element</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of package metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle namespace</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;common&quot;</span><span class="p">:</span> <span class="s2">&quot;http://linux.duke.edu/metadata/common&quot;</span><span class="p">}</span>

        <span class="c1"># Find all package elements</span>
        <span class="n">package_elems</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;common:package&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">package_elems</span><span class="p">:</span>
            <span class="c1"># Try without namespace</span>
            <span class="n">package_elems</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;package&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pkg_elem</span> <span class="ow">in</span> <span class="n">package_elems</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Namespace URI for common elements</span>
                <span class="n">ns_uri</span> <span class="o">=</span> <span class="s2">&quot;{http://linux.duke.edu/metadata/common}&quot;</span>
                <span class="n">rpm_ns</span> <span class="o">=</span> <span class="s2">&quot;{http://linux.duke.edu/metadata/rpm}&quot;</span>

                <span class="c1"># Extract basic info</span>
                <span class="n">name_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">name&quot;</span><span class="p">)</span>
                <span class="n">arch_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">arch&quot;</span><span class="p">)</span>
                <span class="n">version_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">version&quot;</span><span class="p">)</span>
                <span class="n">checksum_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">checksum&quot;</span><span class="p">)</span>
                <span class="n">size_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">size&quot;</span><span class="p">)</span>
                <span class="n">location_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">location&quot;</span><span class="p">)</span>
                <span class="n">summary_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">summary&quot;</span><span class="p">)</span>
                <span class="n">desc_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">description&quot;</span><span class="p">)</span>

                <span class="c1"># Extract extended metadata</span>
                <span class="n">time_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">time&quot;</span><span class="p">)</span>
                <span class="n">format_elem</span> <span class="o">=</span> <span class="n">pkg_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ns_uri</span><span class="si">}</span><span class="s2">format&quot;</span><span class="p">)</span>

                <span class="c1"># Extract RPM-specific metadata from &lt;format&gt; element</span>
                <span class="n">group</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">license_str</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">vendor</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">sourcerpm</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">format_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">group_elem</span> <span class="o">=</span> <span class="n">format_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rpm_ns</span><span class="si">}</span><span class="s2">group&quot;</span><span class="p">)</span>
                    <span class="n">license_elem</span> <span class="o">=</span> <span class="n">format_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rpm_ns</span><span class="si">}</span><span class="s2">license&quot;</span><span class="p">)</span>
                    <span class="n">vendor_elem</span> <span class="o">=</span> <span class="n">format_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rpm_ns</span><span class="si">}</span><span class="s2">vendor&quot;</span><span class="p">)</span>
                    <span class="n">sourcerpm_elem</span> <span class="o">=</span> <span class="n">format_elem</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rpm_ns</span><span class="si">}</span><span class="s2">sourcerpm&quot;</span><span class="p">)</span>

                    <span class="n">group</span> <span class="o">=</span> <span class="n">group_elem</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">group_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">license_str</span> <span class="o">=</span> <span class="n">license_elem</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">license_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">vendor</span> <span class="o">=</span> <span class="n">vendor_elem</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">vendor_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">sourcerpm</span> <span class="o">=</span> <span class="n">sourcerpm_elem</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">sourcerpm_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="c1"># Extract time metadata</span>
                <span class="n">build_time</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">file_time</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">time_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">build_time_str</span> <span class="o">=</span> <span class="n">time_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;build&quot;</span><span class="p">)</span>
                    <span class="n">file_time_str</span> <span class="o">=</span> <span class="n">time_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
                    <span class="n">build_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">build_time_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">build_time_str</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">file_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_time_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">file_time_str</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="c1"># ElementTree elements can be falsy even if not None, so check explicitly</span>
                <span class="k">if</span> <span class="n">name_elem</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">arch_elem</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">version_elem</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">checksum_elem</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">location_elem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Skip incomplete packages</span>

                <span class="n">pkg_meta</span> <span class="o">=</span> <span class="n">PackageMetadata</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name_elem</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">version_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ver&quot;</span><span class="p">),</span>
                    <span class="n">release</span><span class="o">=</span><span class="n">version_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rel&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">epoch</span><span class="o">=</span><span class="n">version_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">),</span>
                    <span class="n">arch</span><span class="o">=</span><span class="n">arch_elem</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">sha256</span><span class="o">=</span><span class="n">checksum_elem</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">size_bytes</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">size_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;package&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">size_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="n">location_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">),</span>
                    <span class="n">summary</span><span class="o">=</span><span class="n">summary_elem</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">summary_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">desc_elem</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">desc_elem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">build_time</span><span class="o">=</span><span class="n">build_time</span><span class="p">,</span>
                    <span class="n">file_time</span><span class="o">=</span><span class="n">file_time</span><span class="p">,</span>
                    <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
                    <span class="n">license</span><span class="o">=</span><span class="n">license_str</span><span class="p">,</span>
                    <span class="n">vendor</span><span class="o">=</span><span class="n">vendor</span><span class="p">,</span>
                    <span class="n">sourcerpm</span><span class="o">=</span><span class="n">sourcerpm</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg_meta</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Skip packages with parsing errors</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Failed to parse package: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="k">return</span> <span class="n">packages</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">packages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">],</span> <span class="n">filters</span><span class="p">:</span> <span class="n">FilterConfig</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply package filters using generic filter engine.</span>

<span class="sd">        Args:</span>
<span class="sd">            packages: List of package metadata</span>
<span class="sd">            filters: Filter configuration</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filtered list of packages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize legacy config to new structure</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>

        <span class="c1"># Validate filter config for RPM repository</span>
        <span class="n">filters</span><span class="o">.</span><span class="n">validate_for_repo_type</span><span class="p">(</span><span class="s2">&quot;rpm&quot;</span><span class="p">)</span>

        <span class="n">filtered_packages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
            <span class="c1"># Apply generic metadata filters</span>
            <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_generic_metadata_filters</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">metadata</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="c1"># Apply RPM-specific filters</span>
            <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">rpm</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_rpm_filters</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">rpm</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="c1"># Apply pattern filters</span>
            <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_pattern_filters</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">patterns</span><span class="p">):</span>
                    <span class="k">continue</span>

            <span class="c1"># Package passed all filters</span>
            <span class="n">filtered_packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>

        <span class="c1"># Apply post-processing (after all filters)</span>
        <span class="k">if</span> <span class="n">filters</span><span class="o">.</span><span class="n">post_processing</span><span class="p">:</span>
            <span class="n">filtered_packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_post_processing</span><span class="p">(</span>
                <span class="n">filtered_packages</span><span class="p">,</span> <span class="n">filters</span><span class="o">.</span><span class="n">post_processing</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_packages</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_generic_metadata_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pkg</span><span class="p">:</span> <span class="n">PackageMetadata</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">GenericMetadataFilterConfig</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if package passes generic metadata filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            pkg: Package metadata</span>
<span class="sd">            metadata: Generic metadata filter config</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if package passes all generic metadata filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Size filter</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">size_bytes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">size_bytes</span><span class="o">.</span><span class="n">min</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">size_bytes</span> <span class="o">&lt;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">size_bytes</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">size_bytes</span><span class="o">.</span><span class="n">max</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">size_bytes</span> <span class="o">&gt;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">size_bytes</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Build time filter</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">build_time</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

            <span class="c1"># Convert package build_time (Unix timestamp) to datetime</span>
            <span class="n">pkg_build_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">build_time</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span><span class="o">.</span><span class="n">newer_than</span><span class="p">:</span>
                <span class="n">newer_than_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span><span class="o">.</span><span class="n">newer_than</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pkg_build_dt</span> <span class="o">&lt;</span> <span class="n">newer_than_dt</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span><span class="o">.</span><span class="n">older_than</span><span class="p">:</span>
                <span class="n">older_than_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span><span class="o">.</span><span class="n">older_than</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pkg_build_dt</span> <span class="o">&gt;</span> <span class="n">older_than_dt</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span><span class="o">.</span><span class="n">last_n_days</span><span class="p">:</span>
                <span class="n">cutoff_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">build_time</span><span class="o">.</span><span class="n">last_n_days</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pkg_build_dt</span> <span class="o">&lt;</span> <span class="n">cutoff_dt</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Architecture filter</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">architectures</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_list_filter</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">architectures</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_rpm_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pkg</span><span class="p">:</span> <span class="n">PackageMetadata</span><span class="p">,</span> <span class="n">rpm_filters</span><span class="p">:</span> <span class="n">RpmFilterConfig</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if package passes RPM-specific filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            pkg: Package metadata</span>
<span class="sd">            rpm_filters: RPM filter config</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if package passes all RPM filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Source RPM filter</span>
        <span class="k">if</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">exclude_source_rpms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pkg</span><span class="o">.</span><span class="n">arch</span> <span class="o">==</span> <span class="s2">&quot;src&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Also check if this is a source RPM by looking at sourcerpm field</span>
            <span class="c1"># (Note: binary RPMs have sourcerpm pointing to the .src.rpm they were built from)</span>
            <span class="c1"># We only want to exclude actual source RPMs (arch == &quot;src&quot;)</span>

        <span class="c1"># Group filter</span>
        <span class="k">if</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">groups</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_list_filter</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">groups</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># License filter</span>
        <span class="k">if</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">licenses</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">license</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_list_filter</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">license</span><span class="p">,</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">licenses</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Vendor filter</span>
        <span class="k">if</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">vendors</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">vendor</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_list_filter</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">vendor</span><span class="p">,</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">vendors</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Epoch filter</span>
        <span class="k">if</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">epochs</span> <span class="ow">and</span> <span class="n">pkg</span><span class="o">.</span><span class="n">epoch</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_list_filter</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">rpm_filters</span><span class="o">.</span><span class="n">epochs</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_list_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">list_filter</span><span class="p">:</span> <span class="n">ListFilterConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if value passes list filter (include/exclude).</span>

<span class="sd">        Args:</span>
<span class="sd">            value: Value to check</span>
<span class="sd">            list_filter: List filter config</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if value passes filter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check include list</span>
        <span class="k">if</span> <span class="n">list_filter</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">list_filter</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check exclude list</span>
        <span class="k">if</span> <span class="n">list_filter</span><span class="o">.</span><span class="n">exclude</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">list_filter</span><span class="o">.</span><span class="n">exclude</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_pattern_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pkg</span><span class="p">:</span> <span class="n">PackageMetadata</span><span class="p">,</span> <span class="n">patterns</span><span class="p">:</span> <span class="n">PatternFilterConfig</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if package passes pattern filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            pkg: Package metadata</span>
<span class="sd">            patterns: Pattern filter config</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if package passes all pattern filters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pkg_name_full</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">release</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">arch</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Include patterns - at least one must match</span>
        <span class="k">if</span> <span class="n">patterns</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
            <span class="n">matched</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">pkg_name_full</span><span class="p">):</span>
                    <span class="n">matched</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matched</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Exclude patterns - none must match</span>
        <span class="k">if</span> <span class="n">patterns</span><span class="o">.</span><span class="n">exclude</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="o">.</span><span class="n">exclude</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">pkg_name_full</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_post_processing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">packages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">],</span> <span class="n">post_proc</span><span class="p">:</span> <span class="s2">&quot;PostProcessingConfig&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply post-processing to filtered packages.</span>

<span class="sd">        Args:</span>
<span class="sd">            packages: Filtered packages</span>
<span class="sd">            post_proc: Post-processing config</span>

<span class="sd">        Returns:</span>
<span class="sd">            Post-processed packages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">chantal.core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">PostProcessingConfig</span>

        <span class="k">if</span> <span class="n">post_proc</span><span class="o">.</span><span class="n">only_latest_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_only_latest_versions</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">post_proc</span><span class="o">.</span><span class="n">only_latest_n_versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_only_latest_versions</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">post_proc</span><span class="o">.</span><span class="n">only_latest_n_versions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">packages</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_keep_only_latest_versions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">packages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">],</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep only the latest N versions of each package (by name and arch).</span>

<span class="sd">        Args:</span>
<span class="sd">            packages: List of packages</span>
<span class="sd">            n: Number of versions to keep (default: 1)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Filtered list with only latest N versions per (name, arch)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Group packages by (name, arch)</span>
        <span class="n">grouped</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">PackageMetadata</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pkg</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span>
            <span class="n">grouped</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span>

        <span class="c1"># For each group, keep only latest N versions</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arch</span><span class="p">),</span> <span class="n">pkg_list</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Sort by version (newest first)</span>
            <span class="c1"># Use tuple comparison: (epoch, version, release) for RPM version semantics</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sorted_pkgs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="n">pkg_list</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">epoch</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Epoch as int</span>
                        <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">version</span><span class="p">),</span>  <span class="c1"># Parse version (without epoch/release)</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>  <span class="c1"># Release as string</span>
                    <span class="p">),</span>
                    <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># If version parsing fails, fall back to simple tuple comparison</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Version parsing failed for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sorted_pkgs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="n">pkg_list</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">epoch</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Keep only latest N versions</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sorted_pkgs</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_existing_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ContentItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get existing content items from database.</span>

<span class="sd">        Args:</span>
<span class="sd">            session: Database session</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping SHA256 -&gt; ContentItem</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_items</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">ContentItem</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ContentItem</span><span class="o">.</span><span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;rpm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="o">.</span><span class="n">sha256</span><span class="p">:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">content_items</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_download_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pkg_meta</span><span class="p">:</span> <span class="n">PackageMetadata</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">,</span>
        <span class="n">repository</span><span class="p">:</span> <span class="n">Repository</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download package and add to storage pool.</span>

<span class="sd">        Args:</span>
<span class="sd">            url: Package download URL</span>
<span class="sd">            pkg_meta: Package metadata</span>
<span class="sd">            session: Database session</span>
<span class="sd">            repository: Repository model instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of bytes downloaded</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.RequestException: On download errors</span>
<span class="sd">            ValueError: On checksum mismatch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Download to temporary file</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.rpm&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_file</span><span class="p">:</span>
            <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Stream download</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
                <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

                <span class="c1"># Download with progress</span>
                <span class="n">bytes_downloaded</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">65536</span><span class="p">):</span>
                    <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="n">bytes_downloaded</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

                <span class="n">tmp_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

                <span class="c1"># Extract filename from location</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># Add to storage pool (will verify SHA256)</span>
                <span class="n">sha256</span><span class="p">,</span> <span class="n">pool_path</span><span class="p">,</span> <span class="n">size_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                    <span class="n">tmp_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">verify_checksum</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

                <span class="c1"># Verify SHA256 matches metadata</span>
                <span class="k">if</span> <span class="n">sha256</span> <span class="o">!=</span> <span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;SHA256 mismatch: expected </span><span class="si">{</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">sha256</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">sha256</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Build RPM metadata</span>
                <span class="n">rpm_metadata</span> <span class="o">=</span> <span class="n">RpmMetadata</span><span class="p">(</span>
                    <span class="n">epoch</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span>
                    <span class="n">release</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">release</span><span class="p">,</span>
                    <span class="n">arch</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span>
                    <span class="n">summary</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Add to database as ContentItem</span>
                <span class="n">content_item</span> <span class="o">=</span> <span class="n">ContentItem</span><span class="p">(</span>
                    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;rpm&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">pkg_meta</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                    <span class="n">sha256</span><span class="o">=</span><span class="n">sha256</span><span class="p">,</span>
                    <span class="n">size_bytes</span><span class="o">=</span><span class="n">size_bytes</span><span class="p">,</span>
                    <span class="n">pool_path</span><span class="o">=</span><span class="n">pool_path</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">content_metadata</span><span class="o">=</span><span class="n">rpm_metadata</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">exclude_none</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">content_item</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

                <span class="c1"># Link content item to repository</span>
                <span class="n">content_item</span><span class="o">.</span><span class="n">repositories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">bytes_downloaded</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Clean up temp file</span>
                <span class="k">if</span> <span class="n">tmp_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">tmp_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Simon Lauger.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>